# ADR-001: Общая архитектура Whale Tracker приложения

## Контекст
Проект - приложение для отслеживания активности китов в криптовалютах. Требуется зафиксировать ключевые архитектурные решения.

## Требования к приложению

### Функциональные требования
1. Отслеживание активности китов в трех блокчейнах: Ethereum, Solana, Tron
2. Интеграция с внешними системами: Helios, Alchemy, CoinGecko и другими провайдерами
3. Хранение истории транзакций с механизмами предотвращения разрастания БД
4. API для разных клиентов: веб-интерфейс, мобильное приложение, Telegram бот
5. Telegram Mini Apps (TMA) для расширенного функционала в Telegram

### Нефункциональные требования
1. Модульность и четкое разделение ответственности
2. Независимость бизнес-логики от клиентов
3. Поддержка множества провайдеров для каждого блокчейна
4. Разные rate limits для разных провайдеров (bottleneck)
5. Отказоустойчивость с Circuit Breaker
6. Масштабируемость хранения данных (pruning, агрегация, TTL)

## Архитектурные решения

### Решение 1: Модульная структура по фичам
Приложение строится как набор модулей, каждый со своей ответственностью.

### Решение 2: Выделение ядра бизнес-логики
Создается отдельный модуль WhalesModule, содержащий всю бизнес-логику. Он не знает о клиентах и используется всеми клиентскими модулями.

### Решение 3: Мульти-провайдерная архитектура для блокчейнов
Каждый блокчейн имеет несколько провайдеров с разными приоритетами, rate limits и конфигурациями. Провайдеры регистрируются в реестре и могут переключаться при сбоях.

### Решение 4: Telegram как отдельный модуль
Telegram функциональность выделена в отдельный модуль, включающий:
- Классического бота (команды)
- TMA (Telegram Mini Apps) с отдельным API и фронтендом

### Решение 5: Единое API для всех клиентов
REST API модуль обслуживает веб и мобильные клиенты, используя ту же бизнес-логику.

## Структура проекта

```
whale-tracker/
├── src/
│   ├── main.ts
│   ├── app.module.ts
│   │
│   ├── config/
│   │   ├── configuration.ts
│   │   └── config.module.ts
│   │
│   ├── common/
│   │   ├── constants/
│   │   ├── decorators/
│   │   ├── filters/
│   │   ├── guards/
│   │   ├── interceptors/
│   │   ├── interfaces/
│   │   ├── pipes/
│   │   ├── utils/
│   │   └── common.module.ts
│   │
│   ├── database/
│   │   ├── kysely/
│   │   ├── migrations/
│   │   ├── repositories/
│   │   └── types/
│   │
│   ├── modules/
│   │   ├── blockchain/
│   │   │   ├── blockchain.module.ts
│   │   │   ├── base/
│   │   │   ├── factory/
│   │   │   ├── health/
│   │   │   └── rate-limiting/
│   │   │
│   │   ├── chains/
│   │   │   ├── chains.module.ts
│   │   │   │
│   │   │   ├── ethereum/
│   │   │   │   ├── ethereum.module.ts
│   │   │   │   ├── ethereum.service.ts
│   │   │   │   ├── providers/
│   │   │   │   └── processors/
│   │   │   │
│   │   │   ├── solana/
│   │   │   │   ├── solana.module.ts
│   │   │   │   ├── solana.service.ts
│   │   │   │   ├── providers/
│   │   │   │   └── processors/
│   │   │   │
│   │   │   └── tron/
│   │   │       ├── tron.module.ts
│   │   │       ├── tron.service.ts
│   │   │       ├── providers/
│   │   │       └── processors/
│   │   │
│   │   ├── whales/
│   │   │   ├── whales.module.ts
│   │   │   ├── entities/
│   │   │   ├── repositories/
│   │   │   └── services/
│   │   │
│   │   ├── api/
│   │   │   ├── api.module.ts
│   │   │   ├── controllers/
│   │   │   ├── dto/
│   │   │   └── responses/
│   │   │
│   │   ├── telegram/
│   │   │   ├── telegram.module.ts
│   │   │   ├── bot/
│   │   │   ├── tma/
│   │   │   ├── scenes/
│   │   │   └── keyboards/
│   │   │
│   │   ├── notifications/
│   │   │   ├── notifications.module.ts
│   │   │   ├── channels/
│   │   │   ├── templates/
│   │   │   └── dispatcher/
│   │   │
│   │   ├── analytics/
│   │   │   ├── analytics.module.ts
│   │   │   ├── services/
│   │   │   └── repositories/
│   │   │
│   │   └── integrations/
│   │       ├── integrations.module.ts
│   │       ├── coingecko/
│   │       └── helios/
│   │
│   └── shared/
│
├── test/
│   ├── unit/
│   ├── integration/
│   └── mocks/
│
├── scripts/
│
└── docs/
    └── adr/
```
